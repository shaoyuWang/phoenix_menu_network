{"remainingRequest":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/src/views/admin/Role.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/src/views/admin/Role.vue","mtime":1548870481000},{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n  data() {\n    return {\n      title: '',\n      roles: [],\n      dialogFormVisible: false,\n      checkSubmit: true,\n      roleId: '',\n      form: {\n        name: '',\n        comment: '',\n      },\n      testName: '',\n      currentRole: [],\n      RolePermission: false,\n    };\n  },\n  mounted(){\n    this.getRoles();\n    // this.getUserAuthority();\n  },\n  methods: {\n    // 提交判断\n    Submit() {\n      this.dialogFormVisible = false;\n      if(this.checkSubmit){\n        this.createRole();\n      }else{\n        this.updateRole();\n      }\n    },\n    // 取消方法\n    Close() {\n      this.dialogFormVisible = false;\n      this.resetDialog();\n    },\n    // 清空模态框\n    resetDialog(){\n      this.form.name = '';\n      this.form.comment = '';\n    },\n    // 添加用户\n    addRole() {\n      this.title = 'Add Role';\n      this.dialogFormVisible = true;\n      this.resetDialog();\n    },\n    // 创建用户方法\n    createRole() {\n      let data = {\n        name: this.form.name,\n        comment: this.form.comment,\n      };\n      // 验证name是否重复\n      this.$axios({\n        url: '/api/v1/roles/' + data.name,\n        method: 'get',\n      }).then(res =>{\n        if(res.data.code == 200){\n          let findName = res.data.data;\n          // 判断name是否为空\n          if(data.name != ''){\n            if(findName != 200){\n              this.$axios({\n                url: '/api/v1/roles',\n                method: 'post',\n                data: data,\n              }).then(res =>{\n                if(res.data.code ==200){\n                  this.getRoles();\n                }else{\n                  this.$router.push({ path: \"/nopermisson\"});\n                }\n              })\n            }else{\n              this.dialogFormVisible = true;\n              alert('Repeat Name, Please Input Again');\n            }\n          }else{\n            this.dialogFormVisible = true;\n            alert('Please Input Name');\n          }\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      });\n      \n    },\n    // 更新用户对话框\n    copyRole(index,data) {\n      this.title = 'Update Role'\n      this.dialogFormVisible = true;\n      this.checkSubmit = false;\n      this.roleId = data.id;\n      this.form.name = data.name;\n      this.form.comment = data.comment;\n      this.testName = data.name;\n    },\n    // 更新角色\n    updateRole(){\n      let data = {\n        name: this.form.name,\n        comment: this.form.comment,\n      };\n      // 验证name是否重复\n      this.$axios({\n        url: '/api/v1/roles/' + data.name,\n        method: 'get',\n      }).then(res =>{\n        console.log(res.data);\n        let findName = res.data.data;\n        if(data.name != ''){\n          if(!findName || this.testName == data.name){\n            this.$axios({\n              url: '/api/v1/roles/' + this.roleId,\n              method: 'put',\n              data: data,\n            }).then(res =>{\n              if(res.data.code == 200){\n                this.getRoles();\n              }else{\n                this.$router.push({ path: \"/nopermisson\"});\n              }\n            });\n          }else{\n            this.dialogFormVisible = true;\n            alert('Repeat Name,Please Input Again');\n          }\n        }else{\n          this.dialogFormVisible = true;\n          alert('Please Input Name');\n        }\n      });\n    },\n    // 删除角色\n    deleteRole(index,data) {\n      this.$axios({\n        url: '/api/v1/roles/' + data.id,\n        method: 'delete',\n      }).then(res =>{\n        if(res.data.code == 200){\n          this.getRoles();\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      })\n    },\n    // 获取所有角色\n    getRoles() {\n      this.$axios({\n        url: '/api/v1/roles',\n        method: 'get',\n      }).then(res =>{\n        if(res.data.code == 200){\n          this.roles = res.data.data;\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      });\n    },\n    // 获取当前用户角色\n    // getUserAuthority() {\n    //   this.$axios({\n    //     url: '/api/v1/users/userAuthority',\n    //     method: 'get'\n    //   }).then(res =>{\n    //     // 判断当前角色权限\n    //     this.RolePermission = false;\n    //     for(var i = 0; i<res.data.roles.length; i++){\n    //       this.currentRole[i] = res.data.roles[i].name;\n    //     }\n    //     console.log(this.currentRole);\n    //     for(var i = 0; i<this.currentRole.length;i ++){\n    //       if(this.currentRole[i] == 'admin'){\n    //         this.RolePermission = true;\n    //       }\n    //     }\n    //     // 获取所有角色\n    //     if(this.RolePermission){\n    //       this.$axios({\n    //         url: '/api/v1/roles',\n    //         method: 'get',\n    //       }).then(res =>{\n    //         if(res.data.code == 200){\n    //           this.roles = res.data.data;\n    //         }else{\n    //           this.$router.push({ path: \"/nopermisson\"});\n    //         }\n    //       });\n    //     }else{\n    //       this.$router.push({ path: \"/nopermisson\"});\n    //     }\n    //   })\n    // }\n  }\n};\n",{"version":3,"sources":["Role.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Role.vue","sourceRoot":"src/views/admin","sourcesContent":["<template>\n  <el-container class=\"container\">\n    <el-header class=\"header\">\n      <el-button type=\"primary\" class=\"add\" @click=\"addRole()\">+Add</el-button>\n    </el-header>\n    <el-row>\n      <el-table :data=\"roles\" stripe style=\"width: 100% ;\">\n        <el-table-column prop=\"id\" label=\"ID\" class-name=\"table_column\"></el-table-column>\n        <el-table-column prop=\"name\" label=\"Name\" class-name=\"table_column\"></el-table-column>\n        <el-table-column prop=\"comment\" label=\"Comment\" class-name=\"table_column\"></el-table-column>\n        <el-table-column label=\"Operation\" class-name=\"table_column\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"small\" @click=\"copyRole(scope.$index,scope.row)\" type=\"primary\" plain>Update</el-button>\n            <el-button size=\"small\" @click=\"deleteRole(scope.$index,scope.row)\" type=\"danger\" plain>Delete</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-row>\n    <!-- 模态框 -->\n    <el-dialog :title=\"title\" :visible.sync=\"dialogFormVisible\" center>\n      <el-form :model=\"form\" ref=\"form\">\n        <el-form-item label=\"RoleName\">\n          <el-input v-model=\"form.name\" placeholder=\"Please Input RoleName\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"Comment\">\n          <el-input type=\"textarea\" v-model=\"form.comment\" placeholder=\"Please Input Comment\"></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button :visible.sync=\"checkSubmit\" type=\"primary\" @click=\"Submit()\">确 定</el-button>\n        <el-button type=\"warning\" @click=\"Close()\">取 消</el-button>\n      </div>\n    </el-dialog>\n  </el-container>\n</template>\n<script>\nexport default {\n  data() {\n    return {\n      title: '',\n      roles: [],\n      dialogFormVisible: false,\n      checkSubmit: true,\n      roleId: '',\n      form: {\n        name: '',\n        comment: '',\n      },\n      testName: '',\n      currentRole: [],\n      RolePermission: false,\n    };\n  },\n  mounted(){\n    this.getRoles();\n    // this.getUserAuthority();\n  },\n  methods: {\n    // 提交判断\n    Submit() {\n      this.dialogFormVisible = false;\n      if(this.checkSubmit){\n        this.createRole();\n      }else{\n        this.updateRole();\n      }\n    },\n    // 取消方法\n    Close() {\n      this.dialogFormVisible = false;\n      this.resetDialog();\n    },\n    // 清空模态框\n    resetDialog(){\n      this.form.name = '';\n      this.form.comment = '';\n    },\n    // 添加用户\n    addRole() {\n      this.title = 'Add Role';\n      this.dialogFormVisible = true;\n      this.resetDialog();\n    },\n    // 创建用户方法\n    createRole() {\n      let data = {\n        name: this.form.name,\n        comment: this.form.comment,\n      };\n      // 验证name是否重复\n      this.$axios({\n        url: '/api/v1/roles/' + data.name,\n        method: 'get',\n      }).then(res =>{\n        if(res.data.code == 200){\n          let findName = res.data.data;\n          // 判断name是否为空\n          if(data.name != ''){\n            if(findName != 200){\n              this.$axios({\n                url: '/api/v1/roles',\n                method: 'post',\n                data: data,\n              }).then(res =>{\n                if(res.data.code ==200){\n                  this.getRoles();\n                }else{\n                  this.$router.push({ path: \"/nopermisson\"});\n                }\n              })\n            }else{\n              this.dialogFormVisible = true;\n              alert('Repeat Name, Please Input Again');\n            }\n          }else{\n            this.dialogFormVisible = true;\n            alert('Please Input Name');\n          }\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      });\n      \n    },\n    // 更新用户对话框\n    copyRole(index,data) {\n      this.title = 'Update Role'\n      this.dialogFormVisible = true;\n      this.checkSubmit = false;\n      this.roleId = data.id;\n      this.form.name = data.name;\n      this.form.comment = data.comment;\n      this.testName = data.name;\n    },\n    // 更新角色\n    updateRole(){\n      let data = {\n        name: this.form.name,\n        comment: this.form.comment,\n      };\n      // 验证name是否重复\n      this.$axios({\n        url: '/api/v1/roles/' + data.name,\n        method: 'get',\n      }).then(res =>{\n        console.log(res.data);\n        let findName = res.data.data;\n        if(data.name != ''){\n          if(!findName || this.testName == data.name){\n            this.$axios({\n              url: '/api/v1/roles/' + this.roleId,\n              method: 'put',\n              data: data,\n            }).then(res =>{\n              if(res.data.code == 200){\n                this.getRoles();\n              }else{\n                this.$router.push({ path: \"/nopermisson\"});\n              }\n            });\n          }else{\n            this.dialogFormVisible = true;\n            alert('Repeat Name,Please Input Again');\n          }\n        }else{\n          this.dialogFormVisible = true;\n          alert('Please Input Name');\n        }\n      });\n    },\n    // 删除角色\n    deleteRole(index,data) {\n      this.$axios({\n        url: '/api/v1/roles/' + data.id,\n        method: 'delete',\n      }).then(res =>{\n        if(res.data.code == 200){\n          this.getRoles();\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      })\n    },\n    // 获取所有角色\n    getRoles() {\n      this.$axios({\n        url: '/api/v1/roles',\n        method: 'get',\n      }).then(res =>{\n        if(res.data.code == 200){\n          this.roles = res.data.data;\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      });\n    },\n    // 获取当前用户角色\n    // getUserAuthority() {\n    //   this.$axios({\n    //     url: '/api/v1/users/userAuthority',\n    //     method: 'get'\n    //   }).then(res =>{\n    //     // 判断当前角色权限\n    //     this.RolePermission = false;\n    //     for(var i = 0; i<res.data.roles.length; i++){\n    //       this.currentRole[i] = res.data.roles[i].name;\n    //     }\n    //     console.log(this.currentRole);\n    //     for(var i = 0; i<this.currentRole.length;i ++){\n    //       if(this.currentRole[i] == 'admin'){\n    //         this.RolePermission = true;\n    //       }\n    //     }\n    //     // 获取所有角色\n    //     if(this.RolePermission){\n    //       this.$axios({\n    //         url: '/api/v1/roles',\n    //         method: 'get',\n    //       }).then(res =>{\n    //         if(res.data.code == 200){\n    //           this.roles = res.data.data;\n    //         }else{\n    //           this.$router.push({ path: \"/nopermisson\"});\n    //         }\n    //       });\n    //     }else{\n    //       this.$router.push({ path: \"/nopermisson\"});\n    //     }\n    //   })\n    // }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n  @import \"../../styles/style.scss\";\n  @import \"../../styles/variables.scss\";\n.container {\n  .header {\n    text-align: right;\n    padding-top: $size10;\n  }\n  /deep/ .table_column{\n    text-align: $position_center;\n  }\n  .input100{\n    width: 100%;\n  }\n}\n</style>\n\n\n\n"]}]}