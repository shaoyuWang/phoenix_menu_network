{"remainingRequest":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/src/views/admin/User.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/src/views/admin/User.vue","mtime":1548869528000},{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangshaoyu/Desktop/毕业设计/phoenix_menu_network/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n  data() {\n    return {\n      title: '',\n      users: [],\n      roles: [],\n      data: [],\n      dialogTableVisible: false,\n      dialogFormVisible: false,\n      checkSubmit: true,\n      hidden: true,\n      roleChecked : [],\n      checkedRoleId: [],\n      form: {\n        username: '',\n        password: '',\n        englishName: '',\n        chinesehName: '',\n        email: '',\n        role_id: [],\n        comment: '',\n      },\n      user_id: '',\n    };\n  },\n  mounted(){\n    this.getUsers();\n    this.getRoles();\n  },\n  methods: {\n    // 拼接多个roles\n    formatter(row,column){\n      let allRole = ''\n      for(var i = 0;i<row.roles.length;i++){\n        allRole += row.roles[i].name + ',';\n      }\n      allRole = allRole.substring(0,allRole.lastIndexOf(','));\n      return allRole;\n    },\n    // 提交点击事件\n    Submit(){\n      this.dialogFormVisible = false;\n      if(this.checkSubmit){\n        this.createUser();\n      }else{\n        this.updateUser();\n      }\n    },\n    //取消方法\n    Close() {\n      this.dialogFormVisible = false;\n      this.resetDialog();\n    },\n    // 清空添加框\n    resetDialog() {\n      this.form.username = '';\n      this.form.password = '';\n      this.form.englishName = '';\n      this.form.chinesehName = '';\n      this.form.email = '';\n      this.form.role_id = [];\n      this.form.comment = '';\n    },\n    // 添加方法\n    addUser() {\n      this.title = 'Add User'\n      this.dialogFormVisible = true;\n      this.hidden = true;\n      this.resetDialog();\n    },\n    // 创建用户\n    createUser(){\n      // 邮箱格式正则\n      let emailValidation = /^[A-Za-z0-9\\u4e00-\\u9fa5]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/;\n      let roles_id = [];\n      for(var i = 0; i< this.form.role_id.length; i++){\n        roles_id.push({id: this.form.role_id[i]});\n      }\n      let data ={\n        username: this.form.username,\n        password: this.form.password,\n        englishName: this.form.englishName,\n        chinesehName: this.form.chinesehName,\n        email: this.form.email,\n        roles: roles_id,\n        comment: this.form.comment,\n      };\n      this.$axios({\n        url: '/api/v1/users/' + data.username,\n        method: 'get',\n      }).then(res =>{\n        if(res.data.code == 200){\n          let findName = res.data.data;\n          // 判断关键值是否为空\n          if(data.username && data.password && data.email != ''){\n            // 判断是否有重复用户名\n            if(findName != 200){\n              // 验证邮箱格式\n              if(emailValidation.test(data.email)){\n                this.$axios({\n                  url: '/api/v1/users',\n                  method: 'post',\n                  data: data,\n                }).then(res=>{\n                  if(res.data.code == 200){\n                    this.getUsers();\n                  }else{\n                    this.$router.push({ path: \"/nopermisson\"});\n                  }\n                });\n              }else{\n                this.dialogFormVisible = true;\n                alert('Please Input Correct Email Format')\n              }\n            }else{\n              this.dialogFormVisible = true;\n              alert('Repeat Username, Please Input Again');\n            }\n          }else{\n            this.dialogFormVisible = true;\n            alert('please Input All Data');\n          }\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      });\n    },\n    // 复写用户信息\n    copyUser(index,data) {\n      this.title = 'Update User'\n      this.dialogFormVisible = true;\n      this.checkSubmit = false;\n      this.hidden = false;\n      this.user_id = data.id;\n      this.form.englishName = data.englishName;\n      this.form.chinesehName = data.chinesehName;\n      this.form.email = data.email;\n      this.roleChecked = data.roles;\n      this.form.comment = data.comment;\n      // 选择角色\n      var role_id = []\n      for(var i = 0;i<data.roles.length;i++){\n        role_id.push(data.roles[i].id)\n      }\n      this.form.role_id=role_id;\n    },\n    // 更新用户\n    updateUser() {\n      // 邮箱格式正则\n      let emailValidation = /^[A-Za-z0-9\\u4e00-\\u9fa5]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/;\n      let roles_id = [];\n      for(var i = 0; i< this.form.role_id.length; i++){\n        roles_id.push({id: this.form.role_id[i]});\n      }\n      let data = {\n        password: this.form.password,\n        englishName: this.form.englishName,\n        chinesehName: this.form.chinesehName,\n        email: this.form.email,\n        roles: roles_id,\n        comment: this.form.comment,\n      };\n      if(data.email != ''){\n        // 验证邮箱格式\n        if(emailValidation.test(data.email)){\n          this.$axios({\n            url: '/api/v1/users/' + this.user_id,\n            method: 'put',\n            data: data,\n          }).then(res=>{\n            if(res.data.code == 200){\n              this.getUsers();\n            }else{\n              this.$router.push({ path: \"/nopermisson\"});\n            }\n          });\n        }else{\n          this.dialogFormVisible = true;\n          alert('Please Input Correct Email Format');\n        }\n      }else{\n        this.dialogFormVisible = true;\n        alert('please Input All Data');\n      }\n    },\n    // 获取用户\n    getUsers() {\n      this.$axios({\n        url: '/api/v1/users',\n        method: 'get',\n      }).then(res=> {\n        if(res.data.code == 200){\n          this.users = res.data.data;\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      })\n    },\n    // 获取角色\n    getRoles(){\n      this.$axios({\n        url: '/api/v1/roles',\n        method: 'get',\n      }).then(res =>{\n        if(res.data.code == 200){\n          this.roles = res.data.data;\n        }else{\n          this.$router.push({ path: \"/nopermisson\"});\n        }\n      })\n    },\n  }\n};\n",null]}